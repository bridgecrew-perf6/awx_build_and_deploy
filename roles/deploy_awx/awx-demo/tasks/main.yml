---
- name: define repository url
  set_fact:
    awx_image_repository: "{{ ((registry_url is defined) | ternary(registry_url, ''), registry_username, 'awx') | path_join }}"
  when: registry_username is defined

- name: create namespace
  kubernetes.core.k8s:
    kubeconfig: /etc/rancher/k3s/k3s.yaml
    state: present
    name: "{{ awx_namespace }}"
    kind: Namespace
    api_version: v1

- name: deploy awx-demo
  kubernetes.core.k8s:
    state: present
    kubeconfig: /etc/rancher/k3s/k3s.yaml
    template: awx-demo.yaml.j2
